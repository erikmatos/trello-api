<script src="https://secure.aadcdn.microsoftonline-p.com/lib/1.0.12/js/adal.min.js"></script>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script>

    var options = {
        instance: 'https://login.microsoftonline.com/',
        tenant: 'common', //COMMON OR YOUR TENANT ID

        clientId: '55e6de20-712c-457e-9107-ef6cd08c1c9b', //This is your client ID
        redirectUri: 'https://kyra-consulting.herokuapp.com/storage/microsoft', //This is your redirect URI

        callback: callback,
        popUp: true
    }

    var authenticationContext = new AuthenticationContext(options);

    function signIn() {
        authenticationContext.login();
    }

    function callback(err, token) {

        console.log('userSignedIn called');
        if (!err) {
            console.log("token: " + token);
            window.location.href = 'https://onedrive.live.com';
            //openOneDrive(token);
        }
        else {
            console.error("error: " + err);
        }
    }

    function openOneDrive(token) {

        if ( token ) {

            $.ajax({
                beforeSend: function(request) {
                    request.setRequestHeader("Authorization", 'bearer ' + token);
                },
                url: 'https://onedrive.live.com',
                dataType: 'json',
                success: function(data) {
                    if (data) {
                        console.log(data);
                    }
                },
                error: function (err, data) {
                    console.log(err);
                }
            });

        } else {


            signIn();


        }
    }
</script>

<html>
    <body>
        <button id="SignIn" onclick="signIn()">One Drive</button>
        <h4 id="WelcomeMessage"></h4>


    </body>
</html>